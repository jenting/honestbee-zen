// +build integration

package integration

import (
	"context"
	"testing"
	"time"

	"github.com/go-test/deep"

	"github.com/honestbee/Zen/models"
)

func TestModelsSyncWithArticles(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description            string
		inputArticles          []*models.Article
		inputGetArticlesParams *models.GetArticlesParams
		inputCountryCode       string
		inputLocale            string
		expectArticles         []*models.Article
		expectCount            int
		expectError            bool
	}{
		{
			description: "testing sync with en-us locale one mock article case",
			inputArticles: []*models.Article{
				&models.Article{
					SectionID:       1234567,
					ID:              3345678,
					AuthorID:        8888888,
					CreatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
					UpdatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
					SourceLocale:    "en-us",
					OutdatedLocales: []string{},
					EditedAt:        time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://sync.test.1",
					HTMLURL:         "https://sync.test.1",
					Name:            "sync test 1",
					Title:           "sync test 1",
					Body:            "<p>sync test 1</p>",
					Locale:          "en-us",
				},
			},
			inputGetArticlesParams: &models.GetArticlesParams{
				SectionID:   1234567,
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			inputLocale:      "en-us",
			inputCountryCode: "tw",
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       1234567,
					ID:              3345678,
					AuthorID:        8888888,
					CreatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
					UpdatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
					SourceLocale:    "en-us",
					OutdatedLocales: []string{},
					EditedAt:        time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://sync.test.1",
					HTMLURL:         "https://sync.test.1",
					Name:            "sync test 1",
					Title:           "sync test 1",
					Body:            "<p>sync test 1</p>",
					Locale:          "en-us",
				},
			},
			expectCount: 1,
		},
		{
			description: "testing sync with all mock article case",
			inputArticles: []*models.Article{
				&models.Article{
					SectionID:       7654321,
					ID:              3345678,
					AuthorID:        9999999,
					CreatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
					UpdatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
					SourceLocale:    "zh-cn",
					OutdatedLocales: []string{"123"},
					EditedAt:        time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
					LabelNames:      []string{"delivered"},
					CountryCode:     "tw",
					URL:             "https://sync.test.1",
					HTMLURL:         "https://sync.test.1",
					Name:            "同步測試 1",
					Title:           "同步測試 1",
					Body:            "<p>同步測試 1</p>",
					Locale:          "zh-tw",
				},
			},
			inputGetArticlesParams: &models.GetArticlesParams{
				SectionID:   7654321,
				Locale:      "zh-tw",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			inputLocale:      "zh-tw",
			inputCountryCode: "tw",
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       7654321,
					ID:              3345678,
					AuthorID:        9999999,
					CreatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
					UpdatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
					SourceLocale:    "zh-cn",
					OutdatedLocales: []string{"123"},
					EditedAt:        time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
					LabelNames:      []string{"delivered"},
					CountryCode:     "tw",
					URL:             "https://sync.test.1",
					HTMLURL:         "https://sync.test.1",
					Name:            "同步測試 1",
					Title:           "同步測試 1",
					Body:            "<p>同步測試 1</p>",
					Locale:          "zh-tw",
				},
			},
			expectCount: 1,
		},
		{
			description: "testing sync back fake data en-us locale case",
			inputArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885507-How-can-I-change-my-email-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885507-How-can-I-change-my-email-address-",
					Name:            "How can I change my email address?",
					Title:           "How can I change my email address?",
					Body:            `<p>Currently,it’s not possible to change your email address. To register with a different email address,please create a new account.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-",
					Name:            "How can I change my credit card,password or delivery address?",
					Title:           "How can I change my credit card,password or delivery address?",
					Body:            `<p>Log in to your account and go to your profile icon at the top right corner. Select Settings from the dropdown menu to edit your details.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-",
					Name:            "Help! I’ve forgotten my password.",
					Title:           "Help! I’ve forgotten my password.",
					Body:            "<p>Click on the Forgot Password link on the Login page and enter your registered email address. We’ll send you an email to reset your password. Occasionally emails end up in the junk/spam folder. Take a look there.</p>",
					Locale:          "en-us",
				},
			},
			inputGetArticlesParams: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			inputLocale:      "en-us",
			inputCountryCode: "tw",
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885507-How-can-I-change-my-email-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885507-How-can-I-change-my-email-address-",
					Name:            "How can I change my email address?",
					Title:           "How can I change my email address?",
					Body:            `<p>Currently,it’s not possible to change your email address. To register with a different email address,please create a new account.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-",
					Name:            "How can I change my credit card,password or delivery address?",
					Title:           "How can I change my credit card,password or delivery address?",
					Body:            `<p>Log in to your account and go to your profile icon at the top right corner. Select Settings from the dropdown menu to edit your details.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-",
					Name:            "Help! I’ve forgotten my password.",
					Title:           "Help! I’ve forgotten my password.",
					Body:            "<p>Click on the Forgot Password link on the Login page and enter your registered email address. We’ll send you an email to reset your password. Occasionally emails end up in the junk/spam folder. Take a look there.</p>",
					Locale:          "en-us",
				},
			},
			expectCount: 5,
		},
		{
			description: "testing sync back fake data zh-tw locale case",
			inputArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86",
					Name:            "救命！我忘記密碼了",
					Title:           "救命！我忘記密碼了",
					Body:            "<p>請在登入頁面點選「忘記密碼」，並輸入您註冊時所使用的電子信箱。我們會寄給您一封信讓您重設密碼。有時候信件會跑到垃圾信件匣，請務必檢查看看。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-",
					Name:            "我的購物車鎖住了，該怎麼辦？",
					Title:           "我的購物車鎖住了，該怎麼辦？",
					Body:            "<p>當結帳出現錯誤時，您的購物車會暫時被鎖住，以避免您的訂單出現異動。要解鎖您的購物車，請在出現提示時，點選「是的，解鎖我的購物車」。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-",
					Name:            "honestbee 的安全政策為何？",
					Title:           "honestbee 的安全政策為何？",
					Body:            `<p>honestbee 很重視您的隱私，並遵循所有相關法規以確保您的資訊安全。請閱讀我們的<a href="https://www.honestbee.tw/privacy-policy">隱私權政策</a>以了解更多資訊。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-",
					Name:            "如何更改電子信箱？",
					Title:           "如何更改電子信箱？",
					Body:            `<p>您的電子信箱目前無法更改。若要以不同信箱進行註冊，請建立新帳號。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-",
					Name:            "如何更改信用卡、密碼或送貨地址？",
					Title:           "如何更改信用卡、密碼或送貨地址？",
					Body:            `<p>登入您的帳號並前往右上角的個人資料圖示。在下拉式選單中選擇「設定」來編輯您的資料。</p>`,
					Locale:          "zh-tw",
				},
			},
			inputGetArticlesParams: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "zh-tw",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			inputLocale:      "zh-tw",
			inputCountryCode: "tw",
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-",
					Name:            "我的購物車鎖住了，該怎麼辦？",
					Title:           "我的購物車鎖住了，該怎麼辦？",
					Body:            "<p>當結帳出現錯誤時，您的購物車會暫時被鎖住，以避免您的訂單出現異動。要解鎖您的購物車，請在出現提示時，點選「是的，解鎖我的購物車」。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-",
					Name:            "honestbee 的安全政策為何？",
					Title:           "honestbee 的安全政策為何？",
					Body:            `<p>honestbee 很重視您的隱私，並遵循所有相關法規以確保您的資訊安全。請閱讀我們的<a href="https://www.honestbee.tw/privacy-policy">隱私權政策</a>以了解更多資訊。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-",
					Name:            "如何更改電子信箱？",
					Title:           "如何更改電子信箱？",
					Body:            `<p>您的電子信箱目前無法更改。若要以不同信箱進行註冊，請建立新帳號。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-",
					Name:            "如何更改信用卡、密碼或送貨地址？",
					Title:           "如何更改信用卡、密碼或送貨地址？",
					Body:            `<p>登入您的帳號並前往右上角的個人資料圖示。在下拉式選單中選擇「設定」來編輯您的資料。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86",
					Name:            "救命！我忘記密碼了",
					Title:           "救命！我忘記密碼了",
					Body:            "<p>請在登入頁面點選「忘記密碼」，並輸入您註冊時所使用的電子信箱。我們會寄給您一封信讓您重設密碼。有時候信件會跑到垃圾信件匣，請務必檢查看看。</p>",
					Locale:          "zh-tw",
				},
			},
			expectCount: 5,
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			err := service.SyncWithArticles(context.Background(), tt.inputArticles, tt.inputCountryCode, tt.inputLocale)
			defer resetDB()

			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else {
				actualArticles, actualCount, err := service.GetArticlesBySectionID(context.Background(), tt.inputGetArticlesParams)
				if err != nil {
					t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
				}
				for _, article := range actualArticles {
					article.CreatedAt = article.CreatedAt.In(time.UTC)
					article.UpdatedAt = article.UpdatedAt.In(time.UTC)
					article.EditedAt = article.EditedAt.In(time.UTC)
				}

				if tt.expectCount != actualCount {
					t.Errorf("[%s] count expect:%v, actual:%v", tt.description, tt.expectCount, actualCount)
				}
				if diff := deep.Equal(tt.expectArticles, actualArticles); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}

func TestModelsSyncWithArticle(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description      string
		inputArticleID   int
		inputArticle     *models.Article
		inputLocale      string
		inputCountryCode string
		expectArticle    *models.Article
		expectError      bool
		expectGetError   bool
	}{
		{
			description:    "testing sync with en-us locale one mock article (INSERT) case",
			inputArticleID: 87654321,
			inputArticle: &models.Article{
				SectionID:       1234567,
				ID:              87654321,
				AuthorID:        8888888,
				CreatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
				UpdatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
				SourceLocale:    "en-us",
				OutdatedLocales: []string{},
				EditedAt:        time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
				LabelNames:      []string{},
				CountryCode:     "tw",
				URL:             "https://sync.test.1",
				HTMLURL:         "https://sync.test.1",
				Name:            "sync test 1",
				Title:           "sync test 1",
				Body:            "<p>sync test 1</p>",
				Locale:          "en-us",
			},
			inputLocale:      "en-us",
			inputCountryCode: "tw",
			expectArticle: &models.Article{
				SectionID:       1234567,
				ID:              87654321,
				AuthorID:        8888888,
				CreatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
				UpdatedAt:       time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
				SourceLocale:    "en-us",
				OutdatedLocales: []string{},
				EditedAt:        time.Date(1988, 10, 13, 3, 30, 59, 0, time.UTC),
				LabelNames:      []string{},
				CountryCode:     "tw",
				URL:             "https://sync.test.1",
				HTMLURL:         "https://sync.test.1",
				Name:            "sync test 1",
				Title:           "sync test 1",
				Body:            "<p>sync test 1</p>",
				Locale:          "en-us",
			},
		},
		{
			description:    "testing sync with zh-tw locale one mock article (UPDATE) case",
			inputArticleID: 87654321,
			inputArticle: &models.Article{
				SectionID:       7654321,
				ID:              87654321,
				AuthorID:        9999999,
				CreatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
				UpdatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
				SourceLocale:    "zh-cn",
				OutdatedLocales: []string{"123"},
				EditedAt:        time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
				LabelNames:      []string{"delivered"},
				CountryCode:     "tw",
				URL:             "https://sync.test.1",
				HTMLURL:         "https://sync.test.1",
				Name:            "同步測試 1",
				Title:           "同步測試 1",
				Body:            "<p>同步測試 1</p>",
				Locale:          "zh-tw",
			},
			inputLocale:      "zh-tw",
			inputCountryCode: "tw",
			expectArticle: &models.Article{
				SectionID:       7654321,
				ID:              87654321,
				AuthorID:        9999999,
				CreatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
				UpdatedAt:       time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
				SourceLocale:    "zh-cn",
				OutdatedLocales: []string{"123"},
				EditedAt:        time.Date(1999, 10, 13, 3, 30, 59, 0, time.UTC),
				LabelNames:      []string{"delivered"},
				CountryCode:     "tw",
				URL:             "https://sync.test.1",
				HTMLURL:         "https://sync.test.1",
				Name:            "同步測試 1",
				Title:           "同步測試 1",
				Body:            "<p>同步測試 1</p>",
				Locale:          "zh-tw",
			},
		},
		{
			description:      "testing sync with zh-tw locale one mock article (DELETE) case",
			inputArticleID:   87654321,
			inputArticle:     nil,
			inputLocale:      "zh-tw",
			inputCountryCode: "tw",
			expectGetError:   true,
			expectArticle:    nil,
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			err := service.SyncWithArticle(context.Background(), tt.inputArticleID, tt.inputArticle, tt.inputCountryCode, tt.inputLocale)
			defer resetDB()

			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else {
				actualArticle, err := service.GetArticleByArticleID(context.Background(), tt.inputArticleID, tt.inputLocale, tt.inputCountryCode)
				if tt.expectGetError && err == nil {
					t.Errorf("[%s] expect an error, actual none", tt.description)
				} else if !tt.expectGetError && err != nil {
					t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
				} else if err == nil {
					actualArticle.CreatedAt = actualArticle.CreatedAt.In(time.UTC)
					actualArticle.UpdatedAt = actualArticle.UpdatedAt.In(time.UTC)
					actualArticle.EditedAt = actualArticle.EditedAt.In(time.UTC)

					if diff := deep.Equal(tt.expectArticle, actualArticle); diff != nil {
						t.Errorf("[%s] %v", tt.description, diff)
					}
				}
			}
		})
	}
}

func TestModelsForceSyncWithArticles(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description             string
		inputArticles1          []*models.Article
		inputCountryCode1       string
		inputLocale1            string
		inputArticles2          []*models.Article
		inputCountryCode2       string
		inputLocale2            string
		inputGetArticlesParams1 *models.GetArticlesParams
		expectArticles1         []*models.Article
		expectCount1            int
		expectError1            bool
		inputGetArticlesParams2 *models.GetArticlesParams
		expectArticles2         []*models.Article
		expectCount2            int
		expectError2            bool
	}{
		{
			description: "testing sync with sg + en-us/zh-cn one mock article case",
			inputArticles1: []*models.Article{
				&models.Article{
					SectionID:       987,
					ID:              978,
					AuthorID:        879,
					CreatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
					UpdatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
					SourceLocale:    "en-us",
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "sg",
					URL:             "https://force.sync.test.1",
					HTMLURL:         "https://force.sync.test.1",
					Name:            "force sync test 1",
					Title:           "force sync test 1",
					Body:            "<p>force sync test 1</p>",
					Locale:          "en-us",
				},
			},
			inputCountryCode1: "sg",
			inputLocale1:      "en-us",
			inputArticles2:    []*models.Article{},
			inputCountryCode2: "sg",
			inputLocale2:      "zh-cn",
			inputGetArticlesParams1: &models.GetArticlesParams{
				SectionID:   987,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount1: 1,
			expectArticles1: []*models.Article{
				&models.Article{
					SectionID:       987,
					ID:              978,
					AuthorID:        879,
					CreatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
					UpdatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
					SourceLocale:    "en-us",
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "sg",
					URL:             "https://force.sync.test.1",
					HTMLURL:         "https://force.sync.test.1",
					Name:            "force sync test 1",
					Title:           "force sync test 1",
					Body:            "<p>force sync test 1</p>",
					Locale:          "en-us",
				},
			},
			inputGetArticlesParams2: &models.GetArticlesParams{
				SectionID:   987,
				Locale:      "zh-cn",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount2:    0,
			expectArticles2: []*models.Article{},
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			service.SyncWithArticles(context.Background(), tt.inputArticles1, tt.inputCountryCode1, tt.inputLocale1)
			service.SyncWithArticles(context.Background(), tt.inputArticles2, tt.inputCountryCode2, tt.inputLocale2)
			defer resetDB()

			actualArticles1, actualCount1, err := service.GetArticles(context.Background(), tt.inputGetArticlesParams1)
			if err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			}
			for _, article := range actualArticles1 {
				article.CreatedAt = article.CreatedAt.In(time.UTC)
				article.UpdatedAt = article.UpdatedAt.In(time.UTC)
				article.EditedAt = article.EditedAt.In(time.UTC)
			}

			if tt.expectCount1 != actualCount1 {
				t.Errorf("[%s] count expect:%v, actual:%v", tt.description, tt.expectCount1, actualCount1)
			}
			if diff := deep.Equal(tt.expectArticles1, actualArticles1); diff != nil {
				t.Errorf("[%s] %v", tt.description, diff)
			}

			actualArticles2, actualCount2, err := service.GetArticles(context.Background(), tt.inputGetArticlesParams2)
			if err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			}
			for _, article := range actualArticles2 {
				article.CreatedAt = article.CreatedAt.In(time.UTC)
				article.UpdatedAt = article.UpdatedAt.In(time.UTC)
				article.EditedAt = article.EditedAt.In(time.UTC)
			}

			if tt.expectCount2 != actualCount2 {
				t.Errorf("[%s] count expect:%v, actual:%v", tt.description, tt.expectCount2, actualCount2)
			}
			if diff := deep.Equal(tt.expectArticles2, actualArticles2); diff != nil {
				t.Errorf("[%s] %v", tt.description, diff)
			}
		})
	}
}

func TestModelsForceSyncWithArticle(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description       string
		inputArticleID    int
		inputArticle1     *models.Article
		inputCountryCode1 string
		inputLocale1      string
		inputArticle2     *models.Article
		inputCountryCode2 string
		inputLocale2      string
		expectError1      bool
		expectArticle1    *models.Article
		expectError2      bool
		expectArticle2    *models.Article
	}{
		{
			description:    "testing sync with sg + en-us/zh-cn one mock article case",
			inputArticleID: 978,
			inputArticle1: &models.Article{
				SectionID:       987,
				ID:              978,
				AuthorID:        879,
				CreatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
				UpdatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
				SourceLocale:    "en-us",
				OutdatedLocales: []string{},
				EditedAt:        time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
				LabelNames:      []string{},
				CountryCode:     "sg",
				URL:             "https://force.sync.test.1",
				HTMLURL:         "https://force.sync.test.1",
				Name:            "force sync test 1",
				Title:           "force sync test 1",
				Body:            "<p>force sync test 1</p>",
				Locale:          "en-us",
			},
			inputCountryCode1: "sg",
			inputLocale1:      "en-us",
			inputArticle2:     &models.Article{},
			inputCountryCode2: "sg",
			inputLocale2:      "zh-cn",
			expectArticle1: &models.Article{
				SectionID:       987,
				ID:              978,
				AuthorID:        879,
				CreatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
				UpdatedAt:       time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
				SourceLocale:    "en-us",
				OutdatedLocales: []string{},
				EditedAt:        time.Date(2000, 12, 12, 2, 22, 22, 0, time.UTC),
				LabelNames:      []string{},
				CountryCode:     "sg",
				URL:             "https://force.sync.test.1",
				HTMLURL:         "https://force.sync.test.1",
				Name:            "force sync test 1",
				Title:           "force sync test 1",
				Body:            "<p>force sync test 1</p>",
				Locale:          "en-us",
			},
			expectError2:   true,
			expectArticle2: &models.Article{},
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			service.SyncWithArticle(context.Background(), tt.inputArticleID, tt.inputArticle1, tt.inputCountryCode1, tt.inputLocale1)
			service.SyncWithArticle(context.Background(), tt.inputArticleID, tt.inputArticle1, tt.inputCountryCode1, tt.inputLocale1)
			defer resetDB()

			actualArticle1, err := service.GetArticleByArticleID(context.Background(), tt.inputArticleID, tt.inputLocale1, tt.inputCountryCode1)
			if tt.expectError1 && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError1 && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				actualArticle1.CreatedAt = actualArticle1.CreatedAt.In(time.UTC)
				actualArticle1.UpdatedAt = actualArticle1.UpdatedAt.In(time.UTC)
				actualArticle1.EditedAt = actualArticle1.EditedAt.In(time.UTC)

				if diff := deep.Equal(tt.expectArticle1, actualArticle1); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}

			actualArticle2, err := service.GetArticleByArticleID(context.Background(), tt.inputArticleID, tt.inputLocale2, tt.inputCountryCode2)
			if tt.expectError2 && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError2 && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				actualArticle2.CreatedAt = actualArticle2.CreatedAt.In(time.UTC)
				actualArticle2.UpdatedAt = actualArticle2.UpdatedAt.In(time.UTC)
				actualArticle2.EditedAt = actualArticle2.EditedAt.In(time.UTC)

				if diff := deep.Equal(tt.expectArticle2, actualArticle2); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}

func TestModelsGetArticles(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description    string
		input          *models.GetArticlesParams
		labelNames     string
		expectError    bool
		expectCount    int
		expectArticles []*models.Article
	}{
		{
			description: "testing normal zh-tw locale case",
			input: &models.GetArticlesParams{
				Locale:      "zh-tw",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-",
					Name:            "我的購物車鎖住了，該怎麼辦？",
					Title:           "我的購物車鎖住了，該怎麼辦？",
					Body:            "<p>當結帳出現錯誤時，您的購物車會暫時被鎖住，以避免您的訂單出現異動。要解鎖您的購物車，請在出現提示時，點選「是的，解鎖我的購物車」。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-",
					Name:            "honestbee 的安全政策為何？",
					Title:           "honestbee 的安全政策為何？",
					Body:            `<p>honestbee 很重視您的隱私，並遵循所有相關法規以確保您的資訊安全。請閱讀我們的<a href="https://www.honestbee.tw/privacy-policy">隱私權政策</a>以了解更多資訊。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-",
					Name:            "如何更改電子信箱？",
					Title:           "如何更改電子信箱？",
					Body:            `<p>您的電子信箱目前無法更改。若要以不同信箱進行註冊，請建立新帳號。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-",
					Name:            "如何更改信用卡、密碼或送貨地址？",
					Title:           "如何更改信用卡、密碼或送貨地址？",
					Body:            `<p>登入您的帳號並前往右上角的個人資料圖示。在下拉式選單中選擇「設定」來編輯您的資料。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86",
					Name:            "救命！我忘記密碼了",
					Title:           "救命！我忘記密碼了",
					Body:            "<p>請在登入頁面點選「忘記密碼」，並輸入您註冊時所使用的電子信箱。我們會寄給您一封信讓您重設密碼。有時候信件會跑到垃圾信件匣，請務必檢查看看。</p>",
					Locale:          "zh-tw",
				},
			},
		},
		{
			description: "testing normal en-us locale case",
			input: &models.GetArticlesParams{
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885507-How-can-I-change-my-email-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885507-How-can-I-change-my-email-address-",
					Name:            "How can I change my email address?",
					Title:           "How can I change my email address?",
					Body:            `<p>Currently,it’s not possible to change your email address. To register with a different email address,please create a new account.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-",
					Name:            "How can I change my credit card,password or delivery address?",
					Title:           "How can I change my credit card,password or delivery address?",
					Body:            `<p>Log in to your account and go to your profile icon at the top right corner. Select Settings from the dropdown menu to edit your details.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-",
					Name:            "Help! I’ve forgotten my password.",
					Title:           "Help! I’ve forgotten my password.",
					Body:            "<p>Click on the Forgot Password link on the Login page and enter your registered email address. We’ll send you an email to reset your password. Occasionally emails end up in the junk/spam folder. Take a look there.</p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing not exist locale case",
			input: &models.GetArticlesParams{
				Locale:      "not-exist-locale",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount:    0,
			expectArticles: []*models.Article{},
		},
		{
			description: "testing not exist country code case",
			input: &models.GetArticlesParams{
				Locale:      "en-us",
				CountryCode: "not-exist-country-code",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount:    0,
			expectArticles: []*models.Article{},
		},
		{
			description: "testing per page 1 case",
			input: &models.GetArticlesParams{
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     1,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing per page 1 page 1 case",
			input: &models.GetArticlesParams{
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     1,
				Page:        1,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing page overflow case",
			input: &models.GetArticlesParams{
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     30,
				Page:        100000,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount:    5,
			expectArticles: []*models.Article{},
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			actualArticles, actualCount, err := service.GetArticles(context.Background(), tt.input)
			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				for _, article := range actualArticles {
					article.CreatedAt = article.CreatedAt.In(time.UTC)
					article.UpdatedAt = article.UpdatedAt.In(time.UTC)
					article.EditedAt = article.EditedAt.In(time.UTC)
				}
				if tt.expectCount != actualCount {
					t.Errorf("[%s] count expect:%v, actual:%v", tt.description, tt.expectCount, actualCount)
				}
				if diff := deep.Equal(tt.expectArticles, actualArticles); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}

func TestModelsGetArticlesByCategoryID(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description    string
		input          *models.GetArticlesParams
		labelNames     []string
		expectArticles []*models.Article
		expectCount    int
		expectError    bool
	}{
		{
			description: "testing normal en-us locale case without label",
			input: &models.GetArticlesParams{
				CategoryID:  115002258488,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{""},
			expectCount: 4,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016053147,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         17,
					VoteCount:       33,
					CreatedAt:       time.Date(2018, 01, 12, 3, 24, 59, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 16, 13, 35, 30, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 17, 18, 0, time.UTC),
					LabelNames:      []string{"use_for_answer_bot", "preparing", "ontheway", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-",
					Name:            "How do I prepare my laundry for pickup?",
					Title:           "How do I prepare my laundry for pickup?",
					Body:            "<p>Please be ready with your laundry when the delivery bee comes. Also check that all clothing pockets are empty, as it will be difficult for us to trace personal articles after your laundry has been handed over. We will not be liable for missing personal articles after you hand it over to us as well.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115016039687,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       9,
					CreatedAt:       time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 10, 04, 17, 49, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					LabelNames:      []string{"delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt",
					Name:            "I have not received my order confirmation/final receipt",
					Title:           "I have not received my order confirmation/final receipt",
					Body:            "<p>We send you your order confirmation immediately after you have placed an order. There is a chance that it might have ended up in the junk/spam folder. Please let us know if you do not find it there.</p>\\n<p><br>We aim to send you your final receipt within 5 working days after we have returned your laundry. Please note that we might adjust your final receipt for any additional articles added to the order and the difference in weight (if any) of your wash and fold loads.</p>\\n<p><br>If this answer did not solve your issue, please contact us and we will do our best to make things right for you. </p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015447167,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       -30,
					CreatedAt:       time.Date(2017, 11, 29, 2, 37, 50, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 14, 10, 33, 44, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 9, 9, 49, 23, 0, time.UTC),
					LabelNames:      []string{"preparing", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015447167-I-want-to-cancel-my-food-order.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015447167-I-want-to-cancel-my-food-order",
					Name:            "I want to cancel my food order",
					Title:           "I want to cancel my food order",
					Body:            "<p><strong>Can I cancel my food order? </strong></p>\\n<p>You may cancel your order before the restaurant has started preparing it. Simply go to <a href=\"https://www.honestbee.sg/en/food/orders\">Your Orders</a> and select the order you wish to cancel.</p>\\n<p>If you do not want your order to be delivered but the food is being prepared or our deliverer is on his way to you, please contact us for assistance. Do note that charges of the food order may still apply to you.</p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015433907,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        2,
					VoteSum:         -12,
					VoteCount:       16,
					CreatedAt:       time.Date(2017, 11, 28, 13, 2, 47, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 17, 11, 3, 40, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 04, 26, 17, 0, time.UTC),
					LabelNames:      []string{"ontheway", "delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-",
					Name:            "What if I am not at home to receive my order?",
					Title:           "What if I am not at home to receive my order?",
					Body:            "<p>If you missed your delivery, please contact us as soon as possible. We will do our best to reschedule your delivery. We reserve the right to charge an additional redelivery fee of $15. Perishables such as meat and frozen food may be discarded in accordance with Food Safety Standards, and are not refundable on your order. </p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing normal en-us locale case with label confirmed",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{"confirmed"},
			expectCount: 2,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016053147,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         17,
					VoteCount:       33,
					CreatedAt:       time.Date(2018, 01, 12, 3, 24, 59, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 16, 13, 35, 30, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 17, 18, 0, time.UTC),
					LabelNames:      []string{"use_for_answer_bot", "preparing", "ontheway", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-",
					Name:            "How do I prepare my laundry for pickup?",
					Title:           "How do I prepare my laundry for pickup?",
					Body:            "<p>Please be ready with your laundry when the delivery bee comes. Also check that all clothing pockets are empty, as it will be difficult for us to trace personal articles after your laundry has been handed over. We will not be liable for missing personal articles after you hand it over to us as well.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015447167,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       -30,
					CreatedAt:       time.Date(2017, 11, 29, 2, 37, 50, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 14, 10, 33, 44, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 9, 9, 49, 23, 0, time.UTC),
					LabelNames:      []string{"preparing", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015447167-I-want-to-cancel-my-food-order.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015447167-I-want-to-cancel-my-food-order",
					Name:            "I want to cancel my food order",
					Title:           "I want to cancel my food order",
					Body:            "<p><strong>Can I cancel my food order? </strong></p>\\n<p>You may cancel your order before the restaurant has started preparing it. Simply go to <a href=\"https://www.honestbee.sg/en/food/orders\">Your Orders</a> and select the order you wish to cancel.</p>\\n<p>If you do not want your order to be delivered but the food is being prepared or our deliverer is on his way to you, please contact us for assistance. Do note that charges of the food order may still apply to you.</p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing normal en-us locale case with label preparing",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{"preparing"},
			expectCount: 2,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016053147,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         17,
					VoteCount:       33,
					CreatedAt:       time.Date(2018, 01, 12, 3, 24, 59, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 16, 13, 35, 30, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 17, 18, 0, time.UTC),
					LabelNames:      []string{"use_for_answer_bot", "preparing", "ontheway", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-",
					Name:            "How do I prepare my laundry for pickup?",
					Title:           "How do I prepare my laundry for pickup?",
					Body:            "<p>Please be ready with your laundry when the delivery bee comes. Also check that all clothing pockets are empty, as it will be difficult for us to trace personal articles after your laundry has been handed over. We will not be liable for missing personal articles after you hand it over to us as well.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015447167,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       -30,
					CreatedAt:       time.Date(2017, 11, 29, 2, 37, 50, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 14, 10, 33, 44, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 9, 9, 49, 23, 0, time.UTC),
					LabelNames:      []string{"preparing", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015447167-I-want-to-cancel-my-food-order.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015447167-I-want-to-cancel-my-food-order",
					Name:            "I want to cancel my food order",
					Title:           "I want to cancel my food order",
					Body:            "<p><strong>Can I cancel my food order? </strong></p>\\n<p>You may cancel your order before the restaurant has started preparing it. Simply go to <a href=\"https://www.honestbee.sg/en/food/orders\">Your Orders</a> and select the order you wish to cancel.</p>\\n<p>If you do not want your order to be delivered but the food is being prepared or our deliverer is on his way to you, please contact us for assistance. Do note that charges of the food order may still apply to you.</p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing normal en-us locale case with label ontheway",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{"ontheway"},
			expectCount: 2,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016053147,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         17,
					VoteCount:       33,
					CreatedAt:       time.Date(2018, 01, 12, 3, 24, 59, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 16, 13, 35, 30, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 17, 18, 0, time.UTC),
					LabelNames:      []string{"use_for_answer_bot", "preparing", "ontheway", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-",
					Name:            "How do I prepare my laundry for pickup?",
					Title:           "How do I prepare my laundry for pickup?",
					Body:            "<p>Please be ready with your laundry when the delivery bee comes. Also check that all clothing pockets are empty, as it will be difficult for us to trace personal articles after your laundry has been handed over. We will not be liable for missing personal articles after you hand it over to us as well.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015433907,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        2,
					VoteSum:         -12,
					VoteCount:       16,
					CreatedAt:       time.Date(2017, 11, 28, 13, 2, 47, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 17, 11, 3, 40, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 04, 26, 17, 0, time.UTC),
					LabelNames:      []string{"ontheway", "delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-",
					Name:            "What if I am not at home to receive my order?",
					Title:           "What if I am not at home to receive my order?",
					Body:            "<p>If you missed your delivery, please contact us as soon as possible. We will do our best to reschedule your delivery. We reserve the right to charge an additional redelivery fee of $15. Perishables such as meat and frozen food may be discarded in accordance with Food Safety Standards, and are not refundable on your order. </p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing normal en-us locale case with label delivered",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{"delivered"},
			expectCount: 2,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016039687,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       9,
					CreatedAt:       time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 10, 04, 17, 49, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					LabelNames:      []string{"delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt",
					Name:            "I have not received my order confirmation/final receipt",
					Title:           "I have not received my order confirmation/final receipt",
					Body:            "<p>We send you your order confirmation immediately after you have placed an order. There is a chance that it might have ended up in the junk/spam folder. Please let us know if you do not find it there.</p>\\n<p><br>We aim to send you your final receipt within 5 working days after we have returned your laundry. Please note that we might adjust your final receipt for any additional articles added to the order and the difference in weight (if any) of your wash and fold loads.</p>\\n<p><br>If this answer did not solve your issue, please contact us and we will do our best to make things right for you. </p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015433907,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        2,
					VoteSum:         -12,
					VoteCount:       16,
					CreatedAt:       time.Date(2017, 11, 28, 13, 2, 47, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 17, 11, 3, 40, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 26, 17, 0, time.UTC),
					LabelNames:      []string{"ontheway", "delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-",
					Name:            "What if I am not at home to receive my order?",
					Title:           "What if I am not at home to receive my order?",
					Body:            "<p>If you missed your delivery, please contact us as soon as possible. We will do our best to reschedule your delivery. We reserve the right to charge an additional redelivery fee of $15. Perishables such as meat and frozen food may be discarded in accordance with Food Safety Standards, and are not refundable on your order. </p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing normal en-us locale case with label ontheway,delivered",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{"ontheway", "delivered"},
			expectCount: 3,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016053147,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         17,
					VoteCount:       33,
					CreatedAt:       time.Date(2018, 01, 12, 3, 24, 59, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 16, 13, 35, 30, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 17, 18, 0, time.UTC),
					LabelNames:      []string{"use_for_answer_bot", "preparing", "ontheway", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-",
					Name:            "How do I prepare my laundry for pickup?",
					Title:           "How do I prepare my laundry for pickup?",
					Body:            "<p>Please be ready with your laundry when the delivery bee comes. Also check that all clothing pockets are empty, as it will be difficult for us to trace personal articles after your laundry has been handed over. We will not be liable for missing personal articles after you hand it over to us as well.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115016039687,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       9,
					CreatedAt:       time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 10, 04, 17, 49, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					LabelNames:      []string{"delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt",
					Name:            "I have not received my order confirmation/final receipt",
					Title:           "I have not received my order confirmation/final receipt",
					Body:            "<p>We send you your order confirmation immediately after you have placed an order. There is a chance that it might have ended up in the junk/spam folder. Please let us know if you do not find it there.</p>\\n<p><br>We aim to send you your final receipt within 5 working days after we have returned your laundry. Please note that we might adjust your final receipt for any additional articles added to the order and the difference in weight (if any) of your wash and fold loads.</p>\\n<p><br>If this answer did not solve your issue, please contact us and we will do our best to make things right for you. </p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015433907,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        2,
					VoteSum:         -12,
					VoteCount:       16,
					CreatedAt:       time.Date(2017, 11, 28, 13, 2, 47, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 17, 11, 3, 40, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 04, 26, 17, 0, time.UTC),
					LabelNames:      []string{"ontheway", "delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115015433907-What-if-I-am-not-at-home-to-receive-my-order-",
					Name:            "What if I am not at home to receive my order?",
					Title:           "What if I am not at home to receive my order?",
					Body:            "<p>If you missed your delivery, please contact us as soon as possible. We will do our best to reschedule your delivery. We reserve the right to charge an additional redelivery fee of $15. Perishables such as meat and frozen food may be discarded in accordance with Food Safety Standards, and are not refundable on your order. </p>\\n<p> </p>\\n<p><button><a href=\"javascript:zE.show();zE.activate();\">Chat with Us</a></button></p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing not exist locale case",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "not-exist-locale",
				CountryCode: "sg",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:     []string{""},
			expectCount:    0,
			expectArticles: []*models.Article{},
		},
		{
			description: "testing not exist country code case",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "not-exist-country-code",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:     []string{""},
			expectCount:    0,
			expectArticles: []*models.Article{},
		},
		{
			description: "testing per page 1 case",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     1,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{""},
			expectCount: 4,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016053147,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         17,
					VoteCount:       33,
					CreatedAt:       time.Date(2018, 01, 12, 3, 24, 59, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 16, 13, 35, 30, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 07, 10, 4, 17, 18, 0, time.UTC),
					LabelNames:      []string{"use_for_answer_bot", "preparing", "ontheway", "confirmed"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016053147-How-do-I-prepare-my-laundry-for-pickup-",
					Name:            "How do I prepare my laundry for pickup?",
					Title:           "How do I prepare my laundry for pickup?",
					Body:            "<p>Please be ready with your laundry when the delivery bee comes. Also check that all clothing pockets are empty, as it will be difficult for us to trace personal articles after your laundry has been handed over. We will not be liable for missing personal articles after you hand it over to us as well.</p>",
					Locale:          "en-us",
				},
			},
		},

		{
			description: "testing per page 1 page 1 case",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     1,
				Page:        1,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:  []string{""},
			expectCount: 4,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115016039687,
					AuthorID:        7222048487,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       9,
					CreatedAt:       time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 07, 10, 04, 17, 49, 0, time.UTC),
					SourceLocale:    "en-us",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 01, 11, 11, 49, 48, 0, time.UTC),
					LabelNames:      []string{"delivered"},
					CountryCode:     "sg",
					URL:             "https://honestbeehelp-sg.zendesk.com/api/v2/help_center/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt.json",
					HTMLURL:         "https://honestbeehelp-sg.zendesk.com/hc/en-us/articles/115016039687-I-have-not-received-my-order-confirmation-final-receipt",
					Name:            "I have not received my order confirmation/final receipt",
					Title:           "I have not received my order confirmation/final receipt",
					Body:            "<p>We send you your order confirmation immediately after you have placed an order. There is a chance that it might have ended up in the junk/spam folder. Please let us know if you do not find it there.</p>\\n<p><br>We aim to send you your final receipt within 5 working days after we have returned your laundry. Please note that we might adjust your final receipt for any additional articles added to the order and the difference in weight (if any) of your wash and fold loads.</p>\\n<p><br>If this answer did not solve your issue, please contact us and we will do our best to make things right for you. </p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing page overflow case",
			input: &models.GetArticlesParams{
				CategoryID:  115002432448,
				Locale:      "en-us",
				CountryCode: "sg",
				PerPage:     30,
				Page:        100000,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			labelNames:     []string{""},
			expectCount:    4,
			expectArticles: []*models.Article{},
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			actualArticles, actualCount, err := service.GetArticlesByCategoryID(context.Background(), tt.input, tt.labelNames)
			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				for _, article := range actualArticles {
					article.CreatedAt = article.CreatedAt.In(time.UTC)
					article.UpdatedAt = article.UpdatedAt.In(time.UTC)
					article.EditedAt = article.EditedAt.In(time.UTC)
				}
				if tt.expectCount != actualCount {
					t.Errorf("[%s] count expect:%v, actual:%v", tt.description, tt.expectCount, actualCount)
				}
				if diff := deep.Equal(tt.expectArticles, actualArticles); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}
func TestModelsGetArticlesBySectionID(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description    string
		input          *models.GetArticlesParams
		expectArticles []*models.Article
		expectCount    int
		expectError    bool
	}{
		{
			description: "testing normal zh-tw locale case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "zh-tw",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-",
					Name:            "我的購物車鎖住了，該怎麼辦？",
					Title:           "我的購物車鎖住了，該怎麼辦？",
					Body:            "<p>當結帳出現錯誤時，您的購物車會暫時被鎖住，以避免您的訂單出現異動。要解鎖您的購物車，請在出現提示時，點選「是的，解鎖我的購物車」。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-",
					Name:            "honestbee 的安全政策為何？",
					Title:           "honestbee 的安全政策為何？",
					Body:            `<p>honestbee 很重視您的隱私，並遵循所有相關法規以確保您的資訊安全。請閱讀我們的<a href="https://www.honestbee.tw/privacy-policy">隱私權政策</a>以了解更多資訊。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-",
					Name:            "如何更改電子信箱？",
					Title:           "如何更改電子信箱？",
					Body:            `<p>您的電子信箱目前無法更改。若要以不同信箱進行註冊，請建立新帳號。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-",
					Name:            "如何更改信用卡、密碼或送貨地址？",
					Title:           "如何更改信用卡、密碼或送貨地址？",
					Body:            `<p>登入您的帳號並前往右上角的個人資料圖示。在下拉式選單中選擇「設定」來編輯您的資料。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86",
					Name:            "救命！我忘記密碼了",
					Title:           "救命！我忘記密碼了",
					Body:            "<p>請在登入頁面點選「忘記密碼」，並輸入您註冊時所使用的電子信箱。我們會寄給您一封信讓您重設密碼。有時候信件會跑到垃圾信件匣，請務必檢查看看。</p>",
					Locale:          "zh-tw",
				},
			},
		},
		{
			description: "testing normal en-us locale case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885507-How-can-I-change-my-email-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885507-How-can-I-change-my-email-address-",
					Name:            "How can I change my email address?",
					Title:           "How can I change my email address?",
					Body:            `<p>Currently,it’s not possible to change your email address. To register with a different email address,please create a new account.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-",
					Name:            "How can I change my credit card,password or delivery address?",
					Title:           "How can I change my credit card,password or delivery address?",
					Body:            `<p>Log in to your account and go to your profile icon at the top right corner. Select Settings from the dropdown menu to edit your details.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-",
					Name:            "Help! I’ve forgotten my password.",
					Title:           "Help! I’ve forgotten my password.",
					Body:            "<p>Click on the Forgot Password link on the Login page and enter your registered email address. We’ll send you an email to reset your password. Occasionally emails end up in the junk/spam folder. Take a look there.</p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing not exist locale case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "not-exist-locale",
				CountryCode: "tw",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount:    0,
			expectArticles: []*models.Article{},
		},
		{
			description: "testing not exist country code case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "en-us",
				CountryCode: "not-exist-country-code",
				PerPage:     30,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount:    0,
			expectArticles: []*models.Article{},
		},
		{
			description: "testing per page 1 case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     1,
				Page:        0,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing per page 1 page 1 case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     1,
				Page:        1,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount: 5,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
			},
		},
		{
			description: "testing page overflow case",
			input: &models.GetArticlesParams{
				SectionID:   115004118448,
				Locale:      "en-us",
				CountryCode: "tw",
				PerPage:     30,
				Page:        100000,
				SortBy:      "position",
				SortOrder:   "asc",
			},
			expectCount:    5,
			expectArticles: []*models.Article{},
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			actualArticles, actualCount, err := service.GetArticlesBySectionID(context.Background(), tt.input)
			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				for _, article := range actualArticles {
					article.CreatedAt = article.CreatedAt.In(time.UTC)
					article.UpdatedAt = article.UpdatedAt.In(time.UTC)
					article.EditedAt = article.EditedAt.In(time.UTC)
				}
				if tt.expectCount != actualCount {
					t.Errorf("[%s] count expect:%v, actual:%v", tt.description, tt.expectCount, actualCount)
				}
				if diff := deep.Equal(tt.expectArticles, actualArticles); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}

func TestModelsGetArticleByArticleID(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description      string
		inputArticleID   int
		inputLocale      string
		inputCountryCode string
		expectArticle    *models.Article
		expectError      bool
	}{
		{
			description:      "testing get en-us locale case",
			inputArticleID:   115015885547,
			inputLocale:      "en-us",
			inputCountryCode: "tw",
			expectArticle: &models.Article{
				SectionID:       115004118448,
				ID:              115015885547,
				AuthorID:        24400224208,
				CommentsDisable: false,
				Draft:           false,
				Promoted:        false,
				Position:        0,
				VoteSum:         0,
				VoteCount:       0,
				CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
				UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
				SourceLocale:    "zh-tw",
				Outdated:        false,
				OutdatedLocales: []string{},
				EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
				LabelNames:      []string{},
				CountryCode:     "tw",
				URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
				HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
				Name:            "What is honestbee’s information security policy?",
				Title:           "What is honestbee’s information security policy?",
				Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
				Locale:          "en-us",
			},
		},
		{
			description:      "testing get zh-tw locale case",
			inputArticleID:   115015885547,
			inputLocale:      "zh-tw",
			inputCountryCode: "tw",
			expectArticle: &models.Article{
				SectionID:       115004118448,
				ID:              115015885547,
				AuthorID:        24400224208,
				CommentsDisable: false,
				Draft:           false,
				Promoted:        false,
				Position:        0,
				VoteSum:         0,
				VoteCount:       0,
				CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
				UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
				SourceLocale:    "zh-tw",
				Outdated:        false,
				OutdatedLocales: []string{},
				EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
				LabelNames:      []string{},
				CountryCode:     "tw",
				URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-.json",
				HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-",
				Name:            "honestbee 的安全政策為何？",
				Title:           "honestbee 的安全政策為何？",
				Body:            `<p>honestbee 很重視您的隱私，並遵循所有相關法規以確保您的資訊安全。請閱讀我們的<a href="https://www.honestbee.tw/privacy-policy">隱私權政策</a>以了解更多資訊。</p>`,
				Locale:          "zh-tw",
			},
		},
		{
			description:      "testing not exist locale case",
			inputArticleID:   115015885547,
			inputLocale:      "not-exist-locale",
			inputCountryCode: "tw",
			expectError:      true,
			expectArticle:    nil,
		},
		{
			description:      "testing not exist country code case",
			inputArticleID:   115015885547,
			inputLocale:      "en-us",
			inputCountryCode: "not-exist-country-code",
			expectError:      true,
			expectArticle:    nil,
		},
		{
			description:      "testing not exist article id case",
			inputArticleID:   675849302348,
			inputLocale:      "en-us",
			inputCountryCode: "tw",
			expectError:      true,
			expectArticle:    nil,
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			actualArticle, err := service.GetArticleByArticleID(context.Background(), tt.inputArticleID, tt.inputLocale, tt.inputCountryCode)
			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				actualArticle.CreatedAt = actualArticle.CreatedAt.In(time.UTC)
				actualArticle.UpdatedAt = actualArticle.UpdatedAt.In(time.UTC)
				actualArticle.EditedAt = actualArticle.EditedAt.In(time.UTC)
				if diff := deep.Equal(tt.expectArticle, actualArticle); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}

func TestModelsGetTopNArticles(t *testing.T) {
	service := newService()
	defer service.Close()
	testCases := []struct {
		description      string
		inputTopN        uint64
		inputLocale      string
		inputCountryCode string
		expectArticles   []*models.Article
		expectError      bool
	}{
		{
			description:      "testing normal zh-tw locale case",
			inputTopN:        5,
			inputLocale:      "zh-tw",
			inputCountryCode: "tw",
			expectError:      false,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959188-%E6%88%91%E7%9A%84%E8%B3%BC%E7%89%A9%E8%BB%8A%E9%8E%96%E4%BD%8F%E4%BA%86-%E8%A9%B2%E6%80%8E%E9%BA%BC%E8%BE%A6-",
					Name:            "我的購物車鎖住了，該怎麼辦？",
					Title:           "我的購物車鎖住了，該怎麼辦？",
					Body:            "<p>當結帳出現錯誤時，您的購物車會暫時被鎖住，以避免您的訂單出現異動。要解鎖您的購物車，請在出現提示時，點選「是的，解鎖我的購物車」。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959148-%E6%95%91%E5%91%BD-%E6%88%91%E5%BF%98%E8%A8%98%E5%AF%86%E7%A2%BC%E4%BA%86",
					Name:            "救命！我忘記密碼了",
					Title:           "救命！我忘記密碼了",
					Body:            "<p>請在登入頁面點選「忘記密碼」，並輸入您註冊時所使用的電子信箱。我們會寄給您一封信讓您重設密碼。有時候信件會跑到垃圾信件匣，請務必檢查看看。</p>",
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885547-honestbee-%E7%9A%84%E5%AE%89%E5%85%A8%E6%94%BF%E7%AD%96%E7%82%BA%E4%BD%95-",
					Name:            "honestbee 的安全政策為何？",
					Title:           "honestbee 的安全政策為何？",
					Body:            `<p>honestbee 很重視您的隱私，並遵循所有相關法規以確保您的資訊安全。請閱讀我們的<a href="https://www.honestbee.tw/privacy-policy">隱私權政策</a>以了解更多資訊。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015885507-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E9%9B%BB%E5%AD%90%E4%BF%A1%E7%AE%B1-",
					Name:            "如何更改電子信箱？",
					Title:           "如何更改電子信箱？",
					Body:            `<p>您的電子信箱目前無法更改。若要以不同信箱進行註冊，請建立新帳號。</p>`,
					Locale:          "zh-tw",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/zh-tw/articles/115015959168-%E5%A6%82%E4%BD%95%E6%9B%B4%E6%94%B9%E4%BF%A1%E7%94%A8%E5%8D%A1-%E5%AF%86%E7%A2%BC%E6%88%96%E9%80%81%E8%B2%A8%E5%9C%B0%E5%9D%80-",
					Name:            "如何更改信用卡、密碼或送貨地址？",
					Title:           "如何更改信用卡、密碼或送貨地址？",
					Body:            `<p>登入您的帳號並前往右上角的個人資料圖示。在下拉式選單中選擇「設定」來編輯您的資料。</p>`,
					Locale:          "zh-tw",
				},
			},
		},
		{
			description:      "testing normal en-us locale case",
			inputTopN:        5,
			inputLocale:      "en-us",
			inputCountryCode: "tw",
			expectError:      false,
			expectArticles: []*models.Article{
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959188,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 14, 48, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 14, 16, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959188-What-can-I-do-when-my-cart-is-locked-",
					Name:            "What can I do when my cart is locked?",
					Title:           "What can I do when my cart is locked?",
					Body:            "<p>When there is an error completing your checkout,your cart will be temporarily locked to prevent further changes to your order. To unlock your cart,click ‘Yes,unlock my cart,’ when prompted.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959148,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -1,
					VoteCount:       1,
					CreatedAt:       time.Date(2017, 12, 27, 2, 59, 48, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 2, 5, 59, 58, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 6, 54, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959148-Help-I-ve-forgotten-my-password-",
					Name:            "Help! I’ve forgotten my password.",
					Title:           "Help! I’ve forgotten my password.",
					Body:            "<p>Click on the Forgot Password link on the Login page and enter your registered email address. We’ll send you an email to reset your password. Occasionally emails end up in the junk/spam folder. Take a look there.</p>",
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885547,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					UpdatedAt:       time.Date(2017, 12, 27, 3, 13, 42, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2017, 12, 27, 3, 12, 58, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885547-What-is-honestbee-s-information-security-policy-",
					Name:            "What is honestbee’s information security policy?",
					Title:           "What is honestbee’s information security policy?",
					Body:            `<p>honestbee takes your privacy seriously and complies with all the relevant laws to ensure your details are kept secure. Read our <a href="https://www.honestbee.tw/privacy-policy">Privacy Policy</a> for more information.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015885507,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         0,
					VoteCount:       0,
					CreatedAt:       time.Date(2017, 12, 27, 3, 11, 30, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015885507-How-can-I-change-my-email-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015885507-How-can-I-change-my-email-address-",
					Name:            "How can I change my email address?",
					Title:           "How can I change my email address?",
					Body:            `<p>Currently,it’s not possible to change your email address. To register with a different email address,please create a new account.</p>`,
					Locale:          "en-us",
				},
				&models.Article{
					SectionID:       115004118448,
					ID:              115015959168,
					AuthorID:        24400224208,
					CommentsDisable: false,
					Draft:           false,
					Promoted:        false,
					Position:        0,
					VoteSum:         -2,
					VoteCount:       -2,
					CreatedAt:       time.Date(2017, 12, 27, 3, 8, 5, 0, time.UTC),
					UpdatedAt:       time.Date(2018, 3, 6, 12, 39, 30, 0, time.UTC),
					SourceLocale:    "zh-tw",
					Outdated:        false,
					OutdatedLocales: []string{},
					EditedAt:        time.Date(2018, 1, 10, 6, 7, 41, 0, time.UTC),
					LabelNames:      []string{},
					CountryCode:     "tw",
					URL:             "https://honestbeehelp-tw.zendesk.com/api/v2/help_center/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-.json",
					HTMLURL:         "https://help.honestbee.tw/hc/en-us/articles/115015959168-How-can-I-change-my-credit-card-password-or-delivery-address-",
					Name:            "How can I change my credit card,password or delivery address?",
					Title:           "How can I change my credit card,password or delivery address?",
					Body:            `<p>Log in to your account and go to your profile icon at the top right corner. Select Settings from the dropdown menu to edit your details.</p>`,
					Locale:          "en-us",
				},
			},
		},
		{
			description:      "testing not exist locale case",
			inputTopN:        5,
			inputLocale:      "not-exist-locale",
			inputCountryCode: "tw",
			expectError:      false,
			expectArticles:   []*models.Article{},
		},
		{
			description:      "testing not exist country code case",
			inputTopN:        5,
			inputLocale:      "en-us",
			inputCountryCode: "not-exist-country-code",
			expectError:      false,
			expectArticles:   []*models.Article{},
		},
	}

	for _, tt := range testCases {
		t.Run(tt.description, func(t *testing.T) {
			actualArticles, err := service.GetTopNArticles(context.Background(), tt.inputTopN, tt.inputLocale, tt.inputCountryCode)
			if tt.expectError && err == nil {
				t.Errorf("[%s] expect an error, actual none", tt.description)
			} else if !tt.expectError && err != nil {
				t.Errorf("[%s] expect no error, actual:%v", tt.description, err)
			} else if err == nil {
				for _, article := range actualArticles {
					article.CreatedAt = article.CreatedAt.In(time.UTC)
					article.UpdatedAt = article.UpdatedAt.In(time.UTC)
					article.EditedAt = article.EditedAt.In(time.UTC)
				}
				if diff := deep.Equal(tt.expectArticles, actualArticles); diff != nil {
					t.Errorf("[%s] %v", tt.description, diff)
				}
			}
		})
	}
}
